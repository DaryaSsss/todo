<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: home.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: home.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {
  useFirestoreCollectionMutation,
  useFirestoreQuery,
} from '@react-query-firebase/firestore';
import { collection, query , onSnapshot} from 'firebase/firestore';
import { useEffect, useState } from 'react';
import Todos from '../components/Todos';
import { firestore, storage } from '../firebase';
import { ref, uploadBytes } from "firebase/storage";
import { generatePushID } from '../helpers';

/** 
 * @module component with createTodo card and all cards from firestore with functions to create todo and upload files */

const Home = () => {
  const [name, setName] = useState('');
  const [desc, setDesc] = useState('');
  const [date, setDate] = useState('');
  const [uploadedFile, setUploadedFile] = useState([])
  const [allTodos, setAllTodos] = useState([])

  const refTodos = collection(firestore, 'todos');
  const mutationCreateTodo = useFirestoreCollectionMutation(refTodos);

/**
 * @method function to get reactive list of all todos 
 * @returns { any[] } - return array of all todos by setting them in allTodos (useState - setAllTodos)
*/
  useEffect(() => {
    const q = query(collection(firestore, "todos"));
    onSnapshot(q, (querySnapshot) => {
      const todos = [];
      querySnapshot.forEach((doc) => {
        const todo = {
          id: doc.id,
          name: doc.data().name,
          desc: doc.data().desc,
          date: doc.data().date,
          isDone: doc.data().isDone,
          fileId: doc.data().fileId,
        }
          todos.push(todo);
      });
      setAllTodos(todos)
    });    
  }, [])
  
/** 
 * @method function to create a new todo */
  const handleTodo = async e => {
    const ID = generatePushID();
    e.preventDefault();
    await onFileUpload({ID});
    await mutationCreateTodo.mutate({
      name,
      desc,
      date,
      isDone: false,
      fileId: ID,
    });
  };

/** 
 * @method function to upload files in storage 
 * @param { string } ID - fileId from todo document, used to name storage folder for todo files
*/
  const onFileUpload = async ({ID}) => {
    if (uploadedFile === null) return;

    for (const file of Array.from(uploadedFile)) {
      const fileRef = ref(storage, `/${ID}/${file.name}`)
      await uploadBytes(fileRef, file)
    }
  }

  return (
    &lt;div>
      &lt;h1 className="App-header">Your TO-DO list&lt;/h1>
      &lt;div className="Home">
        &lt;form onSubmit={handleTodo}>
          &lt;div className="CreateTodo">
            &lt;h2>Create a new to-do&lt;/h2>
            &lt;label>Name*&lt;/label>
            &lt;input
              type="text"
              maxLength={32}
              placeholder="Finish test"
              value={name}
              onChange={e => setName(e.currentTarget.value)}
              required
            />
            &lt;label>Descripiton*&lt;/label>
            &lt;textarea
              rows={5}
              value={desc}
              placeholder="Finish test for work"
              onChange={e => setDesc(e.currentTarget.value)}
              required
            />
            &lt;label>Deadline*&lt;/label>
            &lt;input
              type="date"
              value={date}
              onChange={e => setDate(e.currentTarget.value)}
              required
            />
            &lt;input type="file" multiple onChange={(e) => setUploadedFile(e.target.files)} />
            &lt;button type="submit" disabled={mutationCreateTodo.isLoading}>
              Save to-do
            &lt;/button>
          &lt;/div>
        &lt;/form>
        &lt;div>
          {allTodos.isLoading ? (
            &lt;div>Loading...&lt;/div>
          ) : (
            allTodos.length === 0 ?
            (&lt;div className='NoTodos'>No todos&lt;/div>) : (&lt;Todos todos={allTodos} />)
          )}
        &lt;/div>
      &lt;/div>
    &lt;/div>
  );
};

export default Home;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-component%2520with%2520createTodo%2520card%2520and%2520all%2520cards%2520from%2520firestore%2520with%2520functions%2520to%2520create%2520todo%2520and%2520upload%2520files.html">component with createTodo card and all cards from firestore with functions to create todo and upload files</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Mon Nov 28 2022 19:48:47 GMT+0300 (Москва, стандартное время)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
